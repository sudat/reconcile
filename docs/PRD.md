# プロダクト要件定義（全体）

本ファイルは本プロジェクト全体の要件定義の統合ドキュメントです。個別機能のPRDは各機能配下（例: `docs/balance-detail/PRD.md`）にも保持します。

## 1. 共通UI

### 1.1 テナント切替（サイドバー・フッター）
- 目的: どの会社（テナント）のデータを扱うかをユーザーが明示的に切替できるUIを提供する。
- 配置: サイドバーのフッター。
- 実装: `components/common/nav-user.tsx`。
- ステータス: UIのみ（サーバーアクション・永続化なし）。

#### レスポンシブ方針（2025-09-09 再調整）
- `lg` 以下: サイドバーは非表示（モバイル用ドロワーも提供しない）。
- `xl` 以上: サイドバー表示（`variant: inset`）。
- 付随調整: `SidebarInset` の余白・シャドウ適用は `xl:` から有効化。

#### 要件
- 初期表示で選択状態を保持（コンポーネント内の一時状態）。
- プルダウン（ドロップダウン）で候補を一覧表示し、選択中のテナントにチェックを表示。
- トリガー部にはテナントコードのイニシャルをアバター風に表示し、名称とコードを併記する。

#### サンプルデータ
- DM: DM 株式会社
- PRC: PRC 株式会社

#### 受入基準（UI）
- サイドバー下部のトリガーをクリックすると候補（DM/PRC）が表示される。
- いずれかを選択するとトリガー部の表示が即時に選択先へ更新される。
- 再読込すると初期状態（DM）に戻る（本段階では永続化なし）。

#### 非機能
- shadcn/ui（DropdownMenu, Avatar, Sidebar）に準拠し、既存テーマに整合。
- i18n: ラベルは日本語（例: 「テナントを選択」「データ対象: DM」）。

---

更新履歴:
- 2025-09-07: テナント切替UIを追加（MVP: UIのみ）。
 - 2025-09-07: 照合ページ `/reconcile` をタブUI化（TB/GL）。
 - 2025-09-09: サイドバーの表示ブレークポイントを `xl` 以上へ変更（`lg` 以下は非表示）。

## 2. 照合（TB/GL）

### 2.1 目的
- 本支店勘定の照合作業を「試算表ベース（TB）」と「元帳A/B（GL）」で切替できるタブUIを提供する。

### 2.2 画面仕様（/reconcile）
- 上部に下線タブを1列配置。
  - タブ: 「本支店照合TB」「本支店照合GL」
  - 実装: `components/balance-detail/tab-row.tsx` を再利用（DRY）。
- タブ下のメインエリアに選択中タブのUIのみを表示。
  - TB: `components/tb/tb-form.tsx`
  - GL: `components/ledger/ledger-form.tsx`
- 画面横幅: `container mx-auto p-6 max-w-7xl`（`/balance-detail` と合わせる）。
- 初期選択: 「本支店照合TB」。
- TB/GLフォームはCardラッパー非使用（フラット表示）。見出しはテキストのみ（h2相当）で、結果テーブルもCardなし。
 - タブ非表示側のフォームもアンマウントしない（DOMに残す）。表示は `hidden`/`block` で切替し、TBの照合結果などの一時状態を保持する。

### 2.3 非機能/設計方針
- YAGNI: 新規の状態管理やカードの多重表示は行わず、既存フォームをそのままタブに切替表示。
- DRY: 既存の `TabRow` を再利用し、スタイルやアクセシビリティ属性を統一。
- KISS: サーバーアクションはページ（RSC）側で束ね、タブはクライアント小コンポーネントで最小限の `useState` のみ。

### 2.4 受入基準（UI）
- `/reconcile` にアクセスすると、タブ「本支店照合TB/GL」が表示される。
- タブを切替えるとフォームが入れ替わり、同時表示されない。
- 画面左右の余白/最大幅が `/balance-detail` と同等（`max-w-7xl`）。
- キーボード操作でタブ切替ボタンにフォーカスでき、選択状態がARIAに反映される。
- TB/GLともフォームと結果がCardボックスで囲われていない。
 - TBで照合を実行し結果が表示された状態でGLタブに切替→TBタブへ戻った際、TBの結果表示が維持されている。
